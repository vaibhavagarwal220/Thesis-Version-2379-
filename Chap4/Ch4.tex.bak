\clearpage
\thispagestyle{empty}
~\clearpage
%\graphicspath{{Figures_chapter-4/}}
%\chapter{New Finite Difference Approach Involving Interfacial Points For Solving Immersed Interface Problems And Its Application to Stokes Flows}
%\chapter{New Finite Difference Approach Involving Interfacial Points For Solving Arbitrary Shaped Interface Problems in Cartesian Coordinates}
%\chapter{Interfacial Points Based Finite Difference Scheme For Solving Interface Problems in Cartesian Coordinates}
\chapter{Comparator}
\label{chap4_comparator}
\section{The comparator architecture}
\hspace{4em} The comparator is responsible for sensing the difference between analog voltages available at its input and providing a digital output corresponding to the difference. In a SAR ADC, the comparator is used to decide the comparision level between the sampled input voltage and reference levels generated by the DAC.
The accuracy of the SAR ADC depends on the accuracy of the comparator. Hence, the ADC needs extra care while choosing the architecture and designing the comparator. 

Many comparator topologies are given in literature\cite{2},\cite{32},\cite{4}.\cite{14}. Among which, the most commonly used two topologies have been discussed in the next subsections \ref{stal} and \ref{dll}.

\subsection{Strong ARM Latched Comparator}\label{stal}
\hspace{4em} A strong ARM latch is shown in Figure\ref{sal}. It consists of two cross-coupled pairs (M$_3$-M$_4$ and M$_5$-M$_6$), a clocked differential pair (M$_1$-M$_2$), which is clocked by the clock CK. There are four precharge switches also (S$_1$-S$_4$), which precharge various nodes to $V_{DD}$. The working of a strong ARM latch can be explained in four phases, as follows:
\begin{enumerate}
	\item The clock `CK' is low. It means M$_1$ and M$_2$ are off and all switches S$_1$-S$_4$ are on, therby nodes P, Q, X, and Y are pulled to a large supply voltage, $V_{DD}$.
	\item The clock goes high, turning off the switches S$_1$-S$_4$ and turning the differential pair on. M$_1$ and M$_2$ now draw a current proportional to $V_{IN+}$-$V_{IN-}$. Since, M$_3$-M$_6$ are off, the current flows through the parasitic capacitances at the nodes P and Q. This current increases the voltage $\Vert V_P-V_Q\Vert$. This voltage might go higher than $V_{IN+}$-$V_{IN-}$ and the amplification can be seen in this phase of operation.
	\item As the voltage at nodes P and Q fall below $V_{DD}$-$V_{th}$, the transistors M$_3$ and M$_4$ turn on. However, M$_5$ and M$_6$ are still off. Now, the current flows from the parasitic capacitors of nodes R and S. Hence, voltage at node R ($V_R$) and voltage at node S ($V_S$) fall continuosly.
	\item As soon as the voltage at nodes R and S fall to $ V_{DD}-\Vert V_{th_p} \Vert$, the transistors M$_5$ and M$_6$ get switched on. Note that, the positive feedback pushes one node to $V_{DD}$, while the other is pulled to ground.
\end{enumerate}
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.7\columnwidth]{sal.eps}
	\caption{A strong ARM latch\cite{32}.}
	\label{sal}
\end{figure}

The strong ARM latch consumes, ideally, no static power. Hence, it is used for low power comparator applications. The kickback noise \cite{10} can be removed by using a preamplifier stage before the latch\cite{4}.

\subsection{The Dynamic Latched Comparator}\label{dll}
\hspace{4em} Figure \ref{dl} shows the dynamic latched comparator. The operation of this latch is also similar to the strong ARM latch. Here the input transistors M$_1$ and M$_2$ are isolated from the latch using an inverter stage to avoid loading on M$_1$ and M$_2$ transistors.

When sampling clock `CK' is high, M$_1$ and M$_2$ will be on and nodes P and Q will be pulled down. It will push nodes P' and Q' which results in turning on of M$_10$ and M$_13$ transistors. As M$_10$ and M$_13$ turn on, nodes R and S will be pulled down.
As $V_R$ or $V_S$ reach $\Vert V_{DD}-V_{th_p}\Vert$, one of the pMOS turns on and the positive feedback will push one node to $V_{DD}$, while other node to ground.
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.7\columnwidth]{dynamic.eps}
	\caption{A dynamic latch\cite{4}.}
	\label{dl}
\end{figure}

\section{Implementation}
 \subsection{Comparator}
 \hspace{4em} The design of the comparator decides the performance of the ADC. It compares the sampled signal with the reference voltages and plays a key role in the operation of the SAR logic. For high speed ADC, a dynamic comparator is the common choice\cite{2,32,4,14}. 
 
 \subsection{StrongARM Latch}
 \hspace{4em} Figure~\ref{comparator} shows the design of the strongARM latch. The block consisting of the transistors M$_1$ to M$_9$ is the pre-amplifier. The main purpose of the pre~amplifier is to reduce the effect of kick back noise with improved overall accuracy. Hence a moderate gain pre~amplifier is sufficient, as the dynamic latch stage compensate for the gain requirements. The transistors M$_{10}$ to M$_{19}$ together form the dynamic latched comparator. A strong arm latch is used in our design. There is no static power consumption in this type of comparators. So, overall average power consumption is less. The positive feedback provides the required gain to meet the specifications. The latch transistors are adequately sized for higher speed requirements. The sizes for various transistors are shown in Table~\ref{compsize}. A chain of inverters is connected for better fan out. The output V$_{ON}$ and V$_{OP}$ are connected to SR latch through the inverter chain. The table~\ref{tab} shows the state of comparator outputs. The data ready signal is used to asynchronously trigger the SAR logic. However, the strongARM latch suffers from the systematic offset due to the presence of a preamplifier stage.  
 
 \begin{figure}[!htb]
 	\begin{center}
 		\includegraphics[width=0.7\columnwidth]{comp}
 		\caption{Implemented Strong ARM Latch Comparator.}
 		\label{comparator}
 	\end{center}
 \end{figure}
 \begin{table}[!htb]
 	\centering
 	\caption{Sizes of transistors for adequate dynamic latch operation.}
 	\begin{tabular}{|c|c|c|}
 		\hline
 		Transistor & Size & Multiplier\\
 		& ($\frac{W~nm}{L~nm}$) &  m\\
 		\hline
 		\hline
 		M$_{1}$ & 500/30 & 1\\
 		\hline
 		M$_2$, M$_3$ & 200/30 & 1\\
 		\hline
 		M$_4$, M$_5$ & 170/30 & 1\\
 		\hline
 		M$_6$, M$_8$ & 170/30 & 1\\
 		\hline
 		M$_7$, M$_9$ & 100/30 & 1\\
 		\hline
 		M$_{10}$, M$_{11}$ & 100/30 & 1\\
 		\hline
 		M$_{12}$, M$_{13}$ & 300/30 & 1\\
 		\hline
 		M$_{14}$, M$_{15}$ & 510/30 & 1\\
 		\hline
 		M$_{16}$, M$_{18}$ & 400/30 & 1\\
 		\hline
 		M$_{17}$, M$_{19}$ & 300/30 & 1\\
 		\hline
 		M$_{20}$, M$_{24}$ & 400/30 & 1\\
 		\hline
 		M$_{21}$, M$_{25}$ & 800/30 & 1\\
 		\hline
 		M$_{22}$, M$_{26}$ & 200/30 & 1\\
 		\hline
 		M$_{23}$, M$_{27}$ & 400/30 & 1\\
 		\hline
 	\end{tabular}
 	\label{compsize}
 	
 \end{table}
 
 
 \subsection{A single stage comparator\cite{35}}\label{aaa}
 \hspace{4em} To tackle the issue of offset, another comparator is implemented. This latch based comparator architecture is also dynamic like the strongARM latch. The circuit schematic of this comparator is shown in Figure~\ref{newcomp}. Transistors $M_1$-$M_3$ form the clocked differential pair. $M_6$ and $M_7$ precharge nodes $V_{OP}$ and $V_{ON}$ respectively. It is necessary for reseting the comparator between two successive comparisions. $M_4$, $M_5$, $M_8$, and $M_9$ form the latch. Transistors $M_10$ and $M_11$ are operated with a delayed clock $CLK_2$, which is generated using the buffer $M_12$-$M_15$. These transistors speed up the process of regeneration in the latch. Rest of the circuit serves similar purpose as in the strongARM latch of Figure~\ref{comparator}.
 
 The signal to the latch is given in current-mode in this comparator unlike the strongARM latch. Table~\ref{size} shows the sizes of the transistors as implemented in the design. 
 
 \begin{figure}[!htb]
 	\centering
 	\includegraphics[width = 0.7\columnwidth]{newcomp}
 	\caption{Implemented single stage comparator with low offset.}
 	\label{newcomp}
 \end{figure} 
 
 \begin{table}[!htb]
 	\centering
 	\caption{Sizes of the transistors in the implementation of the circuit in Figure~\ref{newcomp}.}
 	\begin{tabular}{|c|c|c|}
 		\hline
 		Transistor & Size & Multiplier\\
 		& ($\frac{W~nm}{L~nm}$) &  m\\
 		\hline
 		\hline
 		M$_{1}$ & 2000/300 & 1\\
 		\hline
 		M$_2$, M$_3$ & 1000/300 & 1\\
 		\hline
 		M$_4$, M$_5$ & 170/30 & 1\\
 		\hline
 		M$_6$, M$_7$ & 170/30 & 1\\
 		\hline
 		M$_8$, M$_9$ & 100/30 & 1\\
 		\hline
 		M$_{10}$, M$_{11}$ & 100/30 & 1\\
 		\hline
 		M$_{12}$, M$_{14}$ & 170/30 & 1\\
 		\hline
 		M$_{13}$, M$_{15}$ & 100/30 & 1\\
 		\hline
 		M$_{16}$, M$_{18}$ & 170/30 & 1\\
 		\hline
 		M$_{17}$, M$_{19}$ & 100/30 & 1\\
 		\hline
 		M$_{20}$, M$_{21}$ & 170/30 & 1\\
 		\hline
 		M$_{22}$, M$_{23}$ & 100/30 & 1\\
 		\hline
 	\end{tabular}
 	\label{size}
 \end{table}
 
 \begin{table}[!htb]
 	\centering
 	\caption{State of Comparator Outputs in Figure~\ref{comparator} and Figure~\ref{newcomp}.}
 	\label{tab}
 	\begin{tabular}{c|c|c}
 		\hline 
 		V$_{ON}$ &V$_{OP}$& STATE \\
 		\hline
 		1 & 1 & RESET \\
 		1 & 0 & V$_{IN}$ greater than V$_{IP}$\\
 		0 & 1 & V$_{IN}$ lesser than V$_{IP}$\\
 		0 & 0 & INVALID STATE \\
 		\hline
 	\end{tabular}
 \end{table}
%\pagenumbering{arabic}


\section{Inverter based Comparator}
For this thesis, an inverter based comparator is used. The comparator is borrowed from Mr. Dinesh Kumar B.~(PhD Scholar, IIT Mandi). 

The comparator produces a respective output by comparing a variable input with a \emph{fixed threshold voltage}. This motivates to use an inverter circuit which compares the variable input with a designed threshold voltage. The threshold voltage\footnote{The threshold voltage may vary with various process corners.} is very well controlled through the offered resistances of pMOS and nMOS transistors, realizing a CMOS inverter. 
The inverter provides output as follows:
\begin{align}
\centering
\text{V}_\text{OUT} &= 0\quad \text{if}~\text{V}_\text{IN}^\text{*} < \text{V}_\text{CM}\nonumber\\
\text{V}_\text{OUT} &= 1\quad \text{if}~\text{V}_\text{IN}^\text{*} > \text{V}_\text{CM}.
\end{align}
Where, $\text{V}_\text{IN}^\text{*}$ is the sampled version of the input voltage $\text{V}_\text{IN}$. $\text{V}_\text{OUT}$ is the output of the comparator, and $\text{V}_\text{CM}$ is the common-mode voltage. Sampled input signal $\text{V}_\text{IN}^\text{*}$ is compared with $\text{V}_\text{CM}$ to produce $\text{V}_\text{OUT}$. The operation describes the relay-characteristic with saturation. Hence, the inverter can be treated as a comparator with threshold of $\text{V}_\text{CM}$, where $\text{V}_\text{CM} = \text{V}_\text{REF}\text{/2}$.

Fig.~\ref{invcomp2} shows the realization of such a comparator using the chain of inverters along with the biasing circuitry to fix the threshold voltage of the inverters. he number of stages and the aspect ratios of the transistors depend upon speed, resolution, and logical effort requirements~(\cite{sutherland_1999}). Note that the purpose of transistors $M_1$ and $M_2$ is to reduce offset and kick-back noise~(\cite{figueiredo_2006}). The first stage of the chain acts as a preamplifier stage similar to a conventional comparator. The size of the transistors increases in a geometric progression with each stage, considering the logical effort requirement~(\cite{sutherland_1999}). 

\begin{figure}[!htb]
	\begin{center}
		\includegraphics[width=\columnwidth]{COMPv1}
		\caption{complete inverter based comparator including biasing circuitry~(\cite{shrimali_2011}) with delay line}
		\label{invcomp2}
	\end{center}	
\end{figure}

\clearpage 